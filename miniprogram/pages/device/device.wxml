<view class="page-container">
  <!-- 设备详情视图（有设备时显示） -->
  <view class="device-detail" wx:if="{{device}}">
    <!-- 设备信息卡片 -->
    <view class="device-card">
      <view class="device-header">
        <view class="device-name">{{device.name}}</view>
        <view class="edit-icon" bindtap="onEditDevice">
          <image src="/assets/icons/edit.svg" mode="aspectFit" class="edit-image" />
        </view>
      </view>
      <view class="device-status">
        <view class="status-dot {{device.status === 'normal' ? 'status-normal' : 'status-alarm'}}"></view>
        <text class="status-text">当前警报数{{device.currentAlarms}}，总警报数{{device.totalAlarms}}</text>
      </view>
    </view>

    <!-- 分享按钮 -->
    <button class="share-btn" bindtap="onShareToFamily">
      <image src="/assets/icons/share.svg" mode="aspectFit" class="share-icon" />
      <text>分享给家人</text>
    </button>

    <!-- 已分享用户 -->
    <view class="shared-users-section">
      <view class="section-title">已分享用户</view>
      <view class="user-list">
        <view class="user-item" wx:for="{{sharedUsers}}" wx:key="id">
          <view class="user-avatar">{{item.name[0]}}</view>
          <view class="user-name">{{item.name}}</view>
          <view class="user-tag" wx:if="{{item.isOwner}}">所有者</view>
          <view class="remove-btn" wx:else bindtap="onRemoveUser" data-id="{{item.id}}">×</view>
        </view>
      </view>
    </view>

    <!-- 删除设备 -->
    <view class="delete-section">
      <view class="delete-btn" bindtap="onDeleteDevice">删除设备</view>
      <view class="delete-hint">删除后该设备将无法再触发你的通知</view>
    </view>
  </view>

  <!-- 设备配置视图（无设备时显示） -->
  <view class="config-view" wx:else>
    <!-- 配置表单 -->
    <view class="config-form" wx:if="{{configStep === 'idle' || configStep === 'error'}}">
      <view class="form-title">设备配置</view>
      <view class="form-desc">输入 WiFi 信息以配置设备</view>

      <view class="input-group">
        <view class="input-label">WiFi 名称</view>
        <input
          class="input-field"
          placeholder="请输入 WiFi 名称"
          value="{{ssid}}"
          bindinput="onSsidInput"
        />
      </view>

      <view class="input-group">
        <view class="input-label">WiFi 密码</view>
        <input
          class="input-field"
          placeholder="请输入 WiFi 密码"
          password="{{true}}"
          value="{{password}}"
          bindinput="onPasswordInput"
        />
      </view>

      <view class="error-text" wx:if="{{configStep === 'error'}}">{{statusText}}</view>

      <button class="start-btn" bindtap="onStartConfig">开始配置</button>
    </view>

    <!-- 配置进行中 -->
    <view class="progress-state" wx:elif="{{configStep !== 'done'}}">
      <view class="loading-container">
        <view class="loading-spinner"></view>
      </view>
      <view class="progress-status">{{statusText}}</view>
      <button class="cancel-btn" bindtap="onReset">取消</button>
    </view>

    <!-- 配置完成 -->
    <view class="done-state" wx:else>
      <view class="done-icon">
        <view class="checkmark"></view>
      </view>
      <view class="done-title">配置完成</view>

      <view class="result-box" wx:if="{{resultMessage}}">
        <view class="result-label">设备返回信息:</view>
        <view class="result-content">{{resultMessage}}</view>
      </view>

      <button class="reset-btn" bindtap="onReset">重新配置</button>
    </view>
  </view>
</view>
